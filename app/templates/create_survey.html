{% extends "base.html" %} {% block title %} Create a Survey {% endblock %} {% block head %}
<link type="text/css" rel="stylesheet" href="{{ url_for('static', filename='css/drag.css') }}" />
<script src='https://cdnjs.cloudflare.com/ajax/libs/dragula/3.7.2/dragula.min.js'></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
<script type="text/javascript" src="//cdn.jsdelivr.net/bootstrap.daterangepicker/2/daterangepicker.js"></script>
<link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/bootstrap.daterangepicker/2/daterangepicker.css" /> {% endblock head %} {% block page_content %}

<div class="col-md-12 row">
  <form action="" method="post" accept-charset="utf-8">
    <div class="text-center row">
      <p>Choose a Course:</p>
      <select name="course" id="course form-control" class="select input-large">
                {% for course in courses %}
                {% if course == selected_course %}
                <option selected="selected">{{ selected_course }}</option>
                {% else %}
                <option value="{{ course }}">{{ course }}</option>
                {% endif %}
                {% endfor %}
            </select>
    </div>
    <br />

    <div class="row">
      <div class="col-md-12">
        <div class="row text-center">
          <p>Enter title</p>
        </div>
        <input class="form-control input-box" type="text" name="title" id="title" value="{% if survey %}{{ survey.description }}{% endif %}" placeholder="Enter the title of the survey" required/>
      </div>
    </div>
    <div class="col-md-12">
      <div class="row text-center">
        <p>Select time</p>
      </div>
      <div class="row">
        <input class="form-control text-center" type="text" name="choose_date" value="{% if times %}{{times}}{% endif %}" id="choose_date" placeholder="Choose the start date">
      </div>
    </div>

    <br></br>
    <div class="row">
      <div class="text-center col-md-12">
        <p>Select questions to add to the survey</p>
        <br />
      </div>

      <div class="col-sm-6">
        <input type="text" name="search" value="" id="search" class="search-box form-control input-box" placeholder="Search...">
      </div>

      <div class="row drag-wrapper gu-unselectable col-md-12">
        <div class="col-sm-6 drag-container drag-box" id='left'>
          {% for question in questions %}
          <div id="selections" value="{{ question.id }}">{{ question.description }}</div>
          {% endfor %}
        </div>

        <div class="col-sm-6 drag-container drag-box" id='right'>
          {% for question in selected_questions %}
          <div id="selections" value="{{ question.id }}">{{ question.description }}</div>
          {% endfor %}
        </div>
      </div>

    </div>
    <div class="row text-center col-md-12">
      <br />
      <button id="sub" type="submit" class="btn btn-primary" onclick="DoSubmit()">Submit</button>
    </div>
    <input name="questions" id="questions" value=""></input>
  </form>
</div>

<script charset="utf-8">
  dragula([$("#left").get(0), $("#right").get(0)]);
</script>

<script charset="utf-8">
  $('#choose_date').daterangepicker({
    timePicker: true,
    timePickerIncrement: 30,
    locale: {
      format: 'DD/MM/YYYY h:mm A'
    },
    opens: "center",
  });
</script>

<script charset="utf-8">
  function DoSubmit() {
    var a = $('#right').children();
    var b = [];
    for (var i = 0; i < a.length; i++) {
      b.push(a[i].getAttribute('value'));
    }
    $('#questions').attr('value', b);
  }
</script>

<script type="text/javascript">
  $(document).ready(function() {
    $(".select").select2();
  });
</script>

<script charset="utf-8">
  if (!RegExp.escape) {
    RegExp.escape = function(s) {
      return s.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g, "\\$&")
    };
  }

  jQuery(function() {
    var $rows = $('#left').children();
    $('#search').keyup(function() {
      var regex = new RegExp(RegExp.escape($.trim(this.value).replace(/\s+/g, ' ')), 'i')
      $rows.hide().filter(function() {
        var text = $(this).text().replace(/\s+/g, ' ');
        return regex.test(text)
      }).show();
    });
  });
</script>
{% endblock %}
